#!/bin/sh
fail() {
    exec /bin/echo "Failed $1"
}

echo "Starting ramzswap with default params"

mknod -m 0666 /dev/block/ramzswap0 b 254 0
[ $? -eq 0 ] || fail "Failed to create the block device"

insmod /lib/modules/lzo_compress.ko
[ $? -eq 0 ] || fail "Failed to load lzo_compress.ko"

insmod /lib/modules/lzo_decompress.ko
[ $? -eq 0 ] || fail "Failed to load lzo_decompress.ko"

insmod /lib/modules/xvmalloc.ko
[ $? -eq 0 ] || fail "Failed to load xvmalloc.ko"

insmod /lib/modules/ramzswap.ko
[ $? -eq 0 ] || fail "Failed to allocate the storage"

#Turn on swap
sleep 2
echo "Turning on swap..."
swapon /dev/block/ramzswap0
[ $? -eq 0 ] || fail "Failed to turn on the swap"
